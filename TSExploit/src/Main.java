import java.awt.EventQueue;
import java.io.IOException;
import java.io.InputStream;
import java.io.StringWriter;
import java.util.Random;
import java.util.UUID;

import javax.swing.JOptionPane;

import com.sun.jna.platform.win32.Advapi32Util;
import com.sun.jna.platform.win32.WinReg;

import gui.SkiddatePureMerdoni;

public class Main {

	private static final long FunnySerialID_MI_ANNOIO = 12323472346L;
	
	public static final String REGISTRY_PATH = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion";

	static SkiddatePureMerdoni window = new SkiddatePureMerdoni();
	
    public static void main(String[] args) {
    	
    	EventQueue.invokeLater(new Runnable() {
			public void run() {
				try {
					window.frmTeamspeakExploit.setVisible(true);
				} catch (Exception e) {
					e.printStackTrace();
				}
			}
		});
    	
    	if(window.frmTeamspeakExploit.isVisible()) {
    		System.out.println("Nuovo IP Richiesto Al DHCP");
        	
        	try {
    			Runtime.getRuntime().exec("ipconfig /release");
    			System.out.println("Rilasciato Il Vecchio IP");
    			Runtime.getRuntime().exec("ipconfig /renew");
    			System.out.println("Rilasciato Un Nuovo IP Dal Server DHCP-LAN (Se Si Utilizza Una Rete WI-FI Riavviare il Modem)");
    		} catch (IOException e1) {
    			System.out.println("Errore Nella Richiesta.");
    		}
        	
        	
        	String current = readRegistry("HKEY_LOCAL_MACHINE" + "\\" + REGISTRY_PATH, "ProductId");
        	System.out.println("Your Current ID -> " + current);
        	
        	System.out.println("Inizio Modifica Registro Sistema (CurrentVersion)");
        	Advapi32Util.registrySetStringValue(WinReg.HKEY_LOCAL_MACHINE, REGISTRY_PATH, "ProductId", GenerateRandomString());
        	System.out.println("Changed In -> " + Advapi32Util.registryGetStringValue(WinReg.HKEY_LOCAL_MACHINE, REGISTRY_PATH, "ProductId"));

          	System.out.println("Processo Finito! (Rilogga Su TS Con Una Nuova Identità)");
        	System.exit(0);		
    		
    	}
    }
    
    public static final String readRegistry(String location, String key){
        try {
            // Run reg query, then read output with StreamReader (internal class)
            Process process = Runtime.getRuntime().exec("reg query " +
                    '"'+ location + "\" /v " + key);

            StreamReader reader = new StreamReader(process.getInputStream());
            reader.start();
            process.waitFor();
            reader.join();

            // Parse out the value
            // String[] parsed = reader.getResult().split("\\s+");

            String s1[];
            try{
             s1=reader.getResult().split("REG_SZ|REG_DWORD");
            }
            catch(Exception e)
            {
                return " ";
            }
           //MK System.out.println(s1[1].trim());

            return s1[1].trim();
        } catch (Exception e) {
        }

        return null;
    }
     static class StreamReader extends Thread {
        private InputStream is;
        private StringWriter sw= new StringWriter();

        public StreamReader(InputStream is) {
            this.is = is;
        }

        public void run() {
            try {
                int c;
                while ((c = is.read()) != -1)
                    sw.write(c);
            } catch (IOException e) {
            }
        }

        public String getResult() {
            return sw.toString();
        }
    }
    
	public static String GenerateRandomString() {
		return UUID.randomUUID().toString();
	}
    
	public static int GeneraNumeroRandomico(int min, int max) {
		Random rand = new Random();
		int randomNum = rand.nextInt((max - min) + 1) + min;
		return randomNum;
	}
}